(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=function(a,b){function c(){this.constructor=a}for(var d in b)n.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},n={}.hasOwnProperty;f=function(){function a(a){this.command=a}return a.fromCommand=function(a){return new o[a.command](a)},a.prototype.isExecutable=function(){return!0},a.prototype.getLocation=function(a){return a.getStorageLocationAtIndex(this.command.arg1)},a}();var o={};o.LDA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.accumulator=this.getLocation(b).value,a.incrementProgramCounter()},b}(f),o.LDC=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.accumulator=this.command.arg1,a.incrementProgramCounter()},b}(f),o.STA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return this.getLocation(b).value=a.accumulator,a.incrementProgramCounter()},b}(f),o.INP=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.incrementProgramCounter()},b}(f),o.OUT=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.incrementProgramCounter()},b}(f),o.ADC=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.accumulator+=this.command.arg1,a.incrementProgramCounter()},b}(f),o.ADD=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.accumulator+=this.getLocation(b).value,a.incrementProgramCounter()},b}(f),o.SUB=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.accumulator-=this.getLocation(b).value,a.incrementProgramCounter()},b}(f),o.MUL=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.accumulator*=this.getLocation(b).value,a.incrementProgramCounter()},b}(f),o.DIV=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.accumulator/=this.getLocation(b).value,a.incrementProgramCounter()},b}(f),o.BRU=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.programCounter=this.command.arg1},b}(f),o.BPA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.accumulator>0?a.programCounter=this.command.arg1:a.incrementProgramCounter()},b}(f),o.BNA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a.accumulator<0?a.programCounter=this.command.arg1:a.incrementProgramCounter()},b}(f),o.BZA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return 0===a.accumulator?a.programCounter=this.command.arg1:a.incrementProgramCounter()},b}(f),o.STP=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.execute=function(a,b){return a["continue"]=!1},b}(f),g=function(){function a(){}return a.prototype.interpret=function(a){var b,c,d,e;for(c=this.buildMemory(a),e=new j,d=[];e.shouldContinue();)b=c.getInstructionAtIndex(e.programCounter),d.push(b.execute(e,c));return d},a.prototype.buildMemory=function(a){var b,c;return c=function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],null!=b?e.push(f.fromCommand(b)):e.push(new k);return e}(),new h(c)},a}(),h=function(){function a(a){this.values=a}return a.prototype.getInstructionAtIndex=function(a){var b;return b=this.values[a],null!=b&&b.isExecutable()?b:null},a.prototype.getStorageLocationAtIndex=function(a){var b;return b=this.values[a],null==b||b.isExecutable()?null:b},a}(),j=function(){function a(){this.accumulator=Math.round(Math.random()*Math.pow(10,6))/100*(Math.random()>.5?-1:1),this.programCounter=0,this["continue"]=!0}return a.prototype.incrementProgramCounter=function(){return this.programCounter+=1},a.prototype.shouldContinue=function(){return this["continue"]},a}(),k=function(){function a(a){this.value=null!=a?a:null}return a.prototype.isExecutable=function(){return!1},a}(),a=function(){function a(a,b){this.command=a,this.properties=d.get(this.command),null!=b&&(this.arg1=parseFloat(b)),this.resetErrors()}return a.parse=function(b){var c;return c=this.tokenize(this.sanitize(b)),new a(c[0],c[1])},a.sanitize=function(a){return a.trim().replace(/\s+/g," ").toUpperCase()},a.tokenize=function(a){return a.split(" ")},a.prototype.isValid=function(){return this.setErrors(),0===this.errors.length},a.prototype.resetErrors=function(){return this.errors=[]},a.prototype.setErrors=function(){return this.resetErrors(),this.checkCommandExists()&&this.checkValidArity()&&this.checkArgNumericality()},a.prototype.checkCommandExists=function(){return null==this.properties?(this.errors.push("'"+this.command+"' is not a valid command."),!1):!0},a.prototype.checkValidArity=function(){return this.hasValidArity()?!0:(this.errors.push(this.properties.errors.wrongArity),!1)},a.prototype.checkArgNumericality=function(){return this.arity()>0?!isNaN(parseFloat(this.arg1))&&isFinite(this.arg1)?!0:(this.errors.push("The argument following "+this.command+" must be a number."),!1):!0},a.prototype.arity=function(){return null!=this.arg1?1:0},a.prototype.hasValidArity=function(){return this.properties.arity===this.arity()},a}(),d=function(){function a(){}return a.all={LDA:{arity:1,errors:{wrongArity:"LDA must be given a location to load from."}},LDC:{arity:1,errors:{wrongArity:"LDC must be given a constant value to load."}},STA:{arity:1,errors:{wrongArity:"STA must be given a location to store the accumulator value in."}},INP:{arity:1,errors:{wrongArity:"INP must be given a location to store the user inputted value."}},OUT:{arity:1,errors:{wrongArity:"OUT must be given the location of the value to print."}},ADC:{arity:1,errors:{wrongArity:"ADC must be given a constant value to add to the accumulator."}},ADD:{arity:1,errors:{wrongArity:"ADD must be given the location of the value to add to the accumulator."}},SUB:{arity:1,errors:{wrongArity:"SUB must be given the location of the value to subtract from the accumulator."}},MUL:{arity:1,errors:{wrongArity:"MUL must be given the location of the value to subtract from the accumulator."}},DIV:{arity:1,errors:{wrongArity:"DIV must be given the location of the value to subtract from the accumulator."}},BRU:{arity:1,errors:{wrongArity:"BRU must be given the location to branch to."}},BNA:{arity:1,errors:{wrongArity:"BNA must be given the location to branch to."}},BPA:{arity:1,errors:{wrongArity:"BPA must be given the location to branch to."}},BZA:{arity:1,errors:{wrongArity:"BZA must be given the location to branch to."}},STP:{arity:0,errors:{wrongArity:"STP does not accept any arguments."}}},a.get=function(a){return this.all[a]},a}(),i=function(){function a(a,b){null==b&&(b={}),this.container=new e(b),$(a).replaceWith(this.container.elem)}return a.defaultNumColumns=3,a.defaultNumRows=15,a}(),l="undefined"!=typeof exports&&null!==exports?exports:this,l.Rsc=i,b=function(){function b(a){this.elem=$(b.template),this.lineNumber=$(".rsc-line-number",this.elem),this.syntaxErrorField=$(".rsc-syntax-error",this.elem),this.inputField=$("input[type='text']",this.elem),this.command=a,this.inputField.blur(function(a){return function(){return a.validate()}}(this)),this.inputField.keydown(function(a){return function(b){return a.indicatesNextFieldHighlight(b)?a.fireIfDefined("onHighlightNextFieldCallback"):a.indicatesPreviousFieldHighlight(b)?a.fireIfDefined("onHighlightPreviousFieldCallback"):void 0}}(this))}return b.template="<div class='rsc-command-list-item'>\n  <div class='rsc-line-number rsc-computer-font'></div>\n  <input type='text' maxlength='7' class='rsc-computer-font' />\n  <div class='rsc-syntax-error'>Ã—</div>\n</div>",b.prototype.focus=function(){return this.inputField.focus(),this.inputField.select()},b.prototype.validate=function(){var b,c,d;return b=this.inputField.val(),c=!0,""===b.trim()?this.command=null:(this.command=a.parse(this.inputField.val()),c=this.command.isValid()),d=c?"hidden":"visible",this.syntaxErrorField.css("visibility",d),c?this.elem.removeClass("error"):this.elem.addClass("error"),this.fireIfDefined("onValidateFinishedCallback")},b.prototype.onHighlightNextField=function(a){return this.onHighlightNextFieldCallback=a},b.prototype.onHighlightPreviousField=function(a){return this.onHighlightPreviousFieldCallback=a},b.prototype.onValidateFinished=function(a){return this.onValidateFinishedCallback=a},b.prototype.indicatesNextFieldHighlight=function(a){return 13===a.keyCode||40===a.keyCode},b.prototype.indicatesPreviousFieldHighlight=function(a){return 38===a.keyCode},b.prototype.fireIfDefined=function(a){return null!=this[a]?this[a]():void 0},b}(),c=function(){function a(b,c){var d,e,f,g,h,j;this.model=b,null==c&&(c={}),this.elem=$(a.template),this.errorList=$(".rsc-error-list",this.elem),this.numColumns=c.numColumns||i.defaultNumColumns,this.numRows=c.numRows||i.defaultNumRows,f=$(".commands",this.elem),this.columns=function(){var b,c,i;for(i=[],d=b=0,c=this.numColumns;c>=0?c>b:b>c;d=c>=0?++b:--b)e=$(a.columnTemplate),j=function(){var a,b,c;for(c=[],h=a=0,b=this.numRows;b>=0?b>a:a>b;h=b>=0?++a:--a)g=this.createListItemAt(d,h),g.lineNumber.text(this.getLineNumber(d,h).toString()),e.append(g.elem),c.push(g);return c}.call(this),f.append(e),i.push(j);return i}.call(this)}return a.template="<div class='rsc-command-list'>\n  <h4 class='rsc-computer-font'>Command List</h4>\n  <div class='commands'></div>\n  <div class='rsc-error-list'></div>\n</div>",a.columnTemplate="<div class='rsc-command-list-column'></div>",a.errorMessageTemplate="<p>\n  <u><strong>Line %{lineNumber}</strong></u>:\n  <span class='rsc-computer-font'>%{errorMessage}</span>\n</p>",a.prototype.createListItemAt=function(a,c){var d;return d=new b,d.onHighlightNextField(function(b){return function(){return b.getField(b.nextColumn(a,c),b.nextRow(a,c)).focus()}}(this)),d.onHighlightPreviousField(function(b){return function(){return b.getField(b.prevColumn(a,c),b.prevRow(a,c)).focus()}}(this)),d.onValidateFinished(function(a){return function(){return a.updateErrorList()}}(this)),d},a.prototype.updateErrorList=function(){return this.errorList.html(""),this.eachField(function(b){return function(c,d,e){var f,g,h,i,j,k;if(null!=e.command){for(j=e.command.errors,k=[],g=0,h=j.length;h>g;g++)f=j[g],i=b.getLineNumber(c,d),k.push(b.errorList.append(a.errorMessageTemplate.replace("%{lineNumber}",i).replace("%{errorMessage}",f)));return k}}}(this))},a.prototype.prevColumn=function(a,b){return 0===b&&a>0?a-1:a},a.prototype.prevRow=function(a,b){return 0!==b?b-1:a>0?this.numRows-1:b},a.prototype.nextColumn=function(a,b){return b>=this.numRows-1&&a<this.numColumns-1?a+1:a},a.prototype.nextRow=function(a,b){return b>=this.numRows-1?a<this.numColumns-1?0:b:b+1},a.prototype.getLineNumber=function(a,b){return this.getFieldIndex(a,b)+1},a.prototype.getFieldIndex=function(a,b){return a*this.numRows+b},a.prototype.eachField=function(a){var b,c,d,e,f,g,h,i;for(f=this.columns,g=[],b=d=0,e=f.length;e>d;b=++d)c=f[b],g.push(function(){var d,e,f;for(f=[],h=d=0,e=c.length;e>d;h=++d)i=c[h],f.push(a(b,h,this.getField(b,h)));return f}.call(this));return g},a.prototype.getCommands=function(){var a;return a=[],this.eachField(function(b,c,d){return a.push(d.command)}),a},a.prototype.getField=function(a,b){return this.columns[a][b]},a}(),e=function(){function a(b){null==b&&(b={}),this.elem=$(a.template),this.commandList=new c,this.elem.append(this.commandList.elem),$(".click-me",this.elem).click(function(a){return function(){var c,d;return c=new g(b),d=c.interpret(a.commandList.getCommands())}}(this))}return a.template="<div class='rsc-container'>\n  <input type='button' value='Interpret' class='click-me' />\n</div>",a}()}).call(this);