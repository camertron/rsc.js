(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=function(a,b){function c(){this.constructor=a}for(var d in b)G.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},G={}.hasOwnProperty,H=[].slice;r=function(a){function b(a){this.name="NotExecutableError",this.message=a,this.stack=(new Error).stack}return F(b,a),b}(Error),s=function(a){function b(a){this.name="NotStorableError",this.message=a,this.stack=(new Error).stack}return F(b,a),b}(Error),b=function(a){function b(a){this.name="AddressOutOfBoundsError",this.message=a,this.stack=(new Error).stack}return F(b,a),b}(Error),l=function(a){function b(a){this.name="ExecutionTimeoutError",this.message=a,this.stack=(new Error).stack}return F(b,a),b}(Error),m=function(){function a(a){this.command=a}return a.fromCommand=function(a){return new I[a.command](a)},a.prototype.isExecutable=function(){return!0},a.prototype.getLocation=function(a){var c,d;if((c=this.command.arg1-1)>=a.values.length)throw new b("Attempted to access memory address "+this.command.arg1+", which doesn't exist.");if(!(d=a.getStorageLocationAtIndex(c)))throw new s("Attempted to store a value in location "+this.command.arg1+", which contains an instruction.");return d},a.prototype.readLocation=function(a){var b;if(b=this.getLocation(a),null==b.value)throw new s("Attempted to read the value of location "+this.command.arg1+", which doesn't contain a value.");return b.value},a.prototype.writeLocation=function(a,b){return this.getLocation(a).value=b},a}();var I={};I.LDA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.accumulator=this.readLocation(b),a.incrementProgramCounter()},b}(m),I.LDC=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.accumulator=this.command.arg1,a.incrementProgramCounter()},b}(m),I.STA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return this.writeLocation(b,a.accumulator),a.incrementProgramCounter()},b}(m),I.INP=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.waitingForInput=!0,a.continue=!1},b.prototype.resumeWithInput=function(a,b,c,d){return this.writeLocation(c,a),b.waitingForInput=!1,b.continue=!0,b.incrementProgramCounter()},b}(m),I.OUT=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return c.monitor.displayValue(this.readLocation(b)),a.incrementProgramCounter()},b}(m),I.ADC=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.accumulator+=this.command.arg1,a.incrementProgramCounter()},b}(m),I.ADD=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.accumulator+=this.readLocation(b),a.incrementProgramCounter()},b}(m),I.SUB=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.accumulator-=this.readLocation(b),a.incrementProgramCounter()},b}(m),I.MUL=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.accumulator*=this.readLocation(b),a.incrementProgramCounter()},b}(m),I.DIV=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.accumulator/=this.readLocation(b),a.incrementProgramCounter()},b}(m),I.BRU=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.programCounter=this.command.arg1-1},b}(m),I.BPA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.accumulator>0?a.programCounter=this.command.arg1-1:a.incrementProgramCounter()},b}(m),I.BNA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.accumulator<0?a.programCounter=this.command.arg1-1:a.incrementProgramCounter()},b}(m),I.BZA=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return 0===a.accumulator?a.programCounter=this.command.arg1-1:a.incrementProgramCounter()},b}(m),I.STP=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.execute=function(a,b,c){return a.continue=!1,a.stopped=!0,a.incrementProgramCounter()},b}(m),n=function(){function a(a,b,c){this.commands=a,this.peripherals=b,this.session=c,this.memory=this.buildMemory(this.commands)}return a.prototype.onProgramStep=function(a){return this.onProgramStepCallback=a},a.prototype.onProgramStop=function(a){return this.onProgramStopCallback=a},a.prototype.onError=function(a){return this.onErrorCallback=a},a.prototype.getCurrentInstruction=function(){var a;if(null==(a=this.memory.getInstructionAtIndex(this.session.programCounter)))throw new r("The instruction on line "+(this.session.programCounter+1)+" is not executable.");return a},a.prototype.buildMemory=function(a){var b,c;return c=function(){var c,e,f;for(f=[],c=0,e=a.length;c<e;c++)b=a[c],(null!=b?b.constructor:void 0)===d?f.push(m.fromCommand(b)):null!=b&&E.isNumeric(b)?f.push(new x(b)):f.push(new x);return f}(),new p(c)},a}(),p=function(){function a(a){this.values=a}return a.prototype.getInstructionAtIndex=function(a){var b;return b=this.values[a],null!=b&&b.isExecutable()?b:null},a.prototype.getStorageLocationAtIndex=function(a){var b;return b=this.values[a],null==b||b.isExecutable()?null:b},a.prototype.eachStorageLocation=function(a){var b,c,d,e,f;for(f=[],b=c=0,e=this.values.length;0<=e?c<=e:c>=e;b=0<=e?++c:--c)d=this.getStorageLocationAtIndex(b),null!=d?f.push(a(b,d)):f.push(void 0);return f},a}(),v=function(){function a(){this.accumulator=Math.round(Math.random()*Math.pow(10,6))/100*(Math.random()>.5?-1:1),this.reset()}return a.prototype.reset=function(){return this.programCounter=0,this.continue=!0,this.waitingForInput=!1,this.stopped=!1},a.prototype.incrementProgramCounter=function(){return this.programCounter+=1},a.prototype.shouldContinue=function(){return this.continue&&!this.stopped},a.prototype.isWaitingForInput=function(){return this.waitingForInput},a.prototype.hasStopped=function(){return this.stopped},a}(),w=function(a){function b(a,c,d){this.commands=a,this.peripherals=c,this.session=d,b.__super__.constructor.call(this,this.commands,this.peripherals,this.session),this.peripherals.keyboard.onInputReceived(function(a){return function(b){return a.resumeWithInput(b)}}(this))}return F(b,a),b.prototype.start=function(){},b.prototype.resume=function(){var a;try{if(this.session.shouldContinue()&&(this.getCurrentInstruction().execute(this.session,this.memory,this.peripherals),k.fireIfDefined(this,"onProgramStepCallback")),this.session.hasStopped())return k.fireIfDefined(this,"onProgramStopCallback")}catch(b){return a=b,this.session.stopped=!0,k.fireIfDefined(this,"onErrorCallback",a)}},b.prototype.resumeWithInput=function(a){var b,c;if(this.session.isWaitingForInput())try{return b=this.getCurrentInstruction(),b.resumeWithInput(a,this.session,this.memory,this.peripherals),k.fireIfDefined(this,"onProgramStepCallback")}catch(d){return c=d,this.session.stopped=!0,k.fireIfDefined(this,"onErrorCallback",c)}},b.prototype.requiresManualStepping=function(){return!0},b}(n),x=function(){function a(a){this.value=null!=a?a:null}return a.prototype.isExecutable=function(){return!1},a}(),u=function(){function a(a,b){null==b&&(b={}),b.commands=this.getCommandsFromHash(),this.container=new i(b),$(a).replaceWith(this.container.elem),this.session=new v,this.refreshAccumulator(),this.container.controls.onRunProgramButtonClicked(function(a){return function(){var b;return a.container.commandList.getErrors().length>0?void alert("Your program contains one or more syntax errors. Please fix them before running."):(a.session.reset(),a.container.controls.runProgramButton.disable(),a.container.controls.clearMemButton.disable(),a.container.controls.stopButton.enable(),a.container.commandList.disable(),b=new w(a.container.commandList.getCommands(),a.container.peripherals,a.session),b.onProgramStep(function(){return a.refreshInterface(b)}),b.onProgramStop(function(){return a.resetInterface()}),a.container.controls.onStepButtonClicked(function(){return a.session.isWaitingForInput()?alert("Waiting for input..."):a.session.shouldContinue()?b.resume():void 0}),a.container.controls.onStopButtonClicked(function(){return a.resetInterface()}),b.onError(function(b){return a.handleError(b)}),a.refreshInterface(b),b.requiresManualStepping()&&a.container.controls.stepButton.enable(),b.start())}}(this)),this.container.controls.onClearMemButtonClicked(function(a){return function(){if(confirm("Are you sure you want to clear the memory? Your program will be erased."))return a.container.commandList.clear(),a.updateUrl()}}(this)),this.container.commandList.onItemValidationFinished(function(a){return function(){return a.updateUrl()}}(this))}return a.defaultNumColumns=3,a.defaultNumRows=15,a.prototype.refreshInterface=function(a){return this.refreshExecutionLine(),this.refreshAccumulator(),this.refreshMemoryUI(a),this.session.isWaitingForInput()?(this.container.peripherals.keyboard.enable(),this.container.peripherals.keyboard.showIndicator(),this.container.peripherals.keyboard.focus()):(this.container.peripherals.keyboard.disable(),this.container.peripherals.keyboard.hideIndicator())},a.prototype.refreshMemoryUI=function(a){return a.memory.eachStorageLocation(function(a){return function(b,c){return E.isNumeric(c.value)?a.container.commandList.setFieldValueAtIndex(b,c.value):a.container.commandList.clearFieldValueAtIndex(b)}}(this))},a.prototype.refreshExecutionLine=function(){return this.container.commandList.indicateExecutionForLine(this.session.programCounter)},a.prototype.refreshAccumulator=function(){return this.container.peripherals.accumulator.setValue(this.session.accumulator)},a.prototype.resetInterface=function(){return this.container.commandList.reset(),this.container.controls.reset()},a.prototype.handleError=function(a){switch(a.constructor){case r:case s:case b:return alert(a.message+" Program halted."),this.resetInterface();default:throw this.resetInterface(),a}},a.prototype.updateUrl=function(){return"undefined"!=typeof window&&null!==window?window.location.hash=this.container.commandList.toBase64():void 0},a.prototype.getCommandsFromHash=function(){if(!(("undefined"!=typeof window&&null!==window?window.location.hash.length:void 0)>0))return{};try{return JSON.parse(atob(window.location.hash.slice(1)))}catch(a){return{}}},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).Rsc=u,z=function(){function a(a,b){this.program=a,this.testFunc=b,this.inputs=[],this.expectedOutputs=[],this.actualOutputs=null,this.succeeded=void 0,this.message=""}return a.prototype.run=function(){var a,b,c,d,e,f;if(this.testFunc(this),this.succeeded=!0,this.errored=!1,f=new D(this.program,this.inputs),f.onError(function(a){return function(b){return a.message="Error: "+b.message,a.succeeded=!1,a.errored=!0}}(this)),this.actualOutputs=f.run(),!this.errored){if(this.actualOutputs.length!==this.expectedOutputs.length)this.succeeded=!1;else for(e=this.actualOutputs,b=c=0,d=e.length;c<d;b=++c)a=e[b],Math.abs(a-this.expectedOutputs[b])>=.1&&(this.succeeded=!1);if(!this.succeeded)return this.message="Expected "+JSON.stringify(this.actualOutputs)+" to match "+JSON.stringify(this.expectedOutputs)}},a.prototype.setInputs=function(a){this.inputs=a},a.prototype.setOutputs=function(a){this.expectedOutputs=a},a.prototype.didSucceed=function(){return this.succeeded},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).runTestCase=function(a,b){var c;return c=new z(a,b),c.run(),c},C=function(){function a(a){this.accumulator=new y(a),this.monitor=new B,this.keyboard=new A}return a}(),y=function(){function a(a){this.session=a}return a.prototype.getValue=function(){return this.session.accumulator},a.prototype.setValue=function(a){return this.session.accumulator=a},a}(),B=function(){function a(){this.value=null}return a.prototype.displayValue=function(a){return this.value=a,k.fireIfDefined(this,"onValueDisplayedCallback",a)},a.prototype.onValueDisplayed=function(a){return this.onValueDisplayedCallback=a},a}(),A=function(){function a(){}return a.prototype.onInputReceived=function(a){return this.onInputReceivedCallback=a},a}(),D=function(){function a(a,b){this.inputs=b,this.inputCounter=0,this.commands=this.parseCommandList(a),this.session=new v,this.peripherals=new C(this.session),this.interpreter=new w(this.commands,this.peripherals,this.session),this.interpreter.onError(function(a){return function(b){return k.fireIfDefined(a,"onErrorCallback",b)}}(this))}return a.TIMEOUT=2e3,a.prototype.onError=function(a){return this.onErrorCallback=a},a.prototype.run=function(){var b,c,d,e,f;for(d=[],e=new Date,f=!1,1,this.peripherals.monitor.onValueDisplayed(function(a){return d.push(a)});!this.session.hasStopped()&&!f;)this.session.isWaitingForInput()?this.interpreter.resumeWithInput(this.getNextInputValue()):this.interpreter.resume(),b=new Date,f=b-e>=a.TIMEOUT;return f?(c=new l("Timeout! Code took too long to execute."),k.fireIfDefined(this,"onErrorCallback",c),[]):d},a.prototype.getNextInputValue=function(){return this.inputCounter+=1,this.inputs[this.inputCounter-1]},a.prototype.parseCommandList=function(a){var b,c;for(b=e.parse(a),c=u.defaultNumColumns*u.defaultNumRows;!(b.length>=c);)b.push(null);return b},a}(),d=function(){function a(a,b){this.command=a,this.properties=h.get(this.command),null!=b&&E.isNumeric(b)?this.arg1=parseFloat(b):this.arg1=b,this.resetErrors()}return a.parse=function(b){var c;return c=this.tokenize(this.sanitize(b)),new a(c[0],c[1])},a.sanitize=function(a){return a.trim().replace(/\s+/g," ").toUpperCase()},a.tokenize=function(a){return a.split(" ")},a.prototype.isValid=function(){return this.setErrors(),0===this.errors.length},a.prototype.resetErrors=function(){return this.errors=[]},a.prototype.setErrors=function(){return this.resetErrors(),this.checkCommandExists()&&this.checkValidArity()&&this.checkArgNumericality()},a.prototype.checkCommandExists=function(){return null!=this.properties||(this.errors.push("'"+this.command+"' is not a valid command."),!1)},a.prototype.checkValidArity=function(){return!!this.hasValidArity()||(this.errors.push(this.properties.errors.wrongArity),!1)},a.prototype.checkArgNumericality=function(){return!(this.arity()>0)||(!!E.isNumeric(this.arg1)||(this.errors.push("The argument following "+this.command+" must be a number."),!1))},a.prototype.arity=function(){return null!=this.arg1?1:0},a.prototype.hasValidArity=function(){return this.properties.arity===this.arity()},a.prototype.toString=function(){return this.command+(1===this.arity()?" "+this.arg1:"")},a}(),e=function(){function a(){}return a.parse=function(a){var b,c,e,f,g;for(f=a.split("\n"),g=[],c=0,e=f.length;c<e;c++)b=f[c],b.trim().length>0?g.push(d.parse(b.trim())):g.push(null);return g},a}(),h=function(){function a(){}return a.all={LDA:{arity:1,errors:{wrongArity:"LDA must be given a location to load from."}},LDC:{arity:1,errors:{wrongArity:"LDC must be given a constant value to load."}},STA:{arity:1,errors:{wrongArity:"STA must be given a location to store the accumulator value in."}},INP:{arity:1,errors:{wrongArity:"INP must be given a location to store the user inputted value."}},OUT:{arity:1,errors:{wrongArity:"OUT must be given the location of the value to print."}},ADC:{arity:1,errors:{wrongArity:"ADC must be given a constant value to add to the accumulator."}},ADD:{arity:1,errors:{wrongArity:"ADD must be given the location of the value to add to the accumulator."}},SUB:{arity:1,errors:{wrongArity:"SUB must be given the location of the value to subtract from the accumulator."}},MUL:{arity:1,errors:{wrongArity:"MUL must be given the location of the value to multiply the accumulator by."}},DIV:{arity:1,errors:{wrongArity:"DIV must be given the location of the value to divide from accumulator by."}},BRU:{arity:1,errors:{wrongArity:"BRU must be given the location to branch to."}},BNA:{arity:1,errors:{wrongArity:"BNA must be given the location to branch to."}},BPA:{arity:1,errors:{wrongArity:"BPA must be given the location to branch to."}},BZA:{arity:1,errors:{wrongArity:"BZA must be given the location to branch to."}},STP:{arity:0,errors:{wrongArity:"STP does not accept any arguments."}}},a.get=function(a){return this.all[a]},a}(),k=function(){function a(){}return a.fireIfDefined=function(){var a,b,c;if(c=arguments[0],b=arguments[1],a=3<=arguments.length?H.call(arguments,2):[],null!=c[b])return c[b].apply(this,a)},a}(),E=function(){function a(){}return a.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},a}(),a=function(){function a(){this.elem=$(a.template),this.valueField=$(".rsc-accumulator-value",this.elem)}return a.template="<div class='rsc-peripheral-accumulator rsc-computer-font'>\n  Accumulator: <span class='rsc-accumulator-value'></span>\n</div>",a.prototype.setValue=function(a){return this.valueField.text(a.toFixed(1))},a.prototype.getValue=function(){if(E.isNumeric(this.valueField.text()))return parseFloat(this.valueField.text())},a}(),c=function(){function a(b,c){null==c&&(c={}),this.elem=$(a.template),this.elem.val(b),null!=c.classes&&this.elem.addClass(c.classes.join(" ")),null==c.enabled||c.enabled||this.elem.prop("disabled",!0),this.elem.click(function(a){return function(){return k.fireIfDefined(a,"onClickCallback")}}(this))}return a.template="<input type='button' class='rsc-button' />",a.prototype.onClick=function(a){return this.onClickCallback=a},a.prototype.enable=function(){return this.elem.prop("disabled",!1)},a.prototype.disable=function(){return this.elem.prop("disabled",!0)},a}(),f=function(){function a(b){this.elem=$(a.template),this.lineNumber=$(".rsc-line-number",this.elem),this.indicator=$(".rsc-indicator",this.elem),this.inputField=$("input[type='text']",this.elem),this.command=b,this.inputField.blur(function(a){return function(){return a.validate()}}(this)),this.inputField.keydown(function(a){return function(b){return a.indicatesNextFieldHighlight(b)?k.fireIfDefined(a,"onHighlightNextFieldCallback"):a.indicatesPreviousFieldHighlight(b)?k.fireIfDefined(a,"onHighlightPreviousFieldCallback"):a.indicatesInsertRow(b)?k.fireIfDefined(a,"onInsertRowCallback"):a.indicatesDeleteRow(b)?(b.preventDefault(),k.fireIfDefined(a,"onDeleteRowCallback")):void 0}}(this))}return a.template="<div class='rsc-command-list-item'>\n  <div class='rsc-line-number rsc-computer-font'></div>\n  <input type='text' maxlength='7' class='rsc-input-field rsc-computer-font' />\n  <div class='rsc-indicator'></div>\n</div>",a.prototype.showExecutionIndicator=function(){return this.elem.addClass("info")},a.prototype.showErrorIndicator=function(){return this.elem.addClass("error")},a.prototype.hideIndicator=function(){return this.elem.removeClass("error info")},a.prototype.disable=function(){return this.inputField.prop("disabled",!0)},a.prototype.enable=function(){return this.inputField.prop("disabled",!1)},a.prototype.clear=function(){return this.inputField.val(""),this.command=null,this.hideIndicator()},a.prototype.focus=function(){return this.inputField.focus(),this.inputField.select()},a.prototype.validate=function(){var a,b;return a=this.inputField.val(),b=!0,""===a.trim()?this.command=null:E.isNumeric(this.inputField.val())?this.command=parseFloat(this.inputField.val()):(this.command=d.parse(this.inputField.val()),b=this.command.isValid()),b?this.hideIndicator():this.showErrorIndicator(),k.fireIfDefined(this,"onValidateFinishedCallback")},a.prototype.onHighlightNextField=function(a){return this.onHighlightNextFieldCallback=a},a.prototype.onHighlightPreviousField=function(a){return this.onHighlightPreviousFieldCallback=a},a.prototype.onInsertRow=function(a){return this.onInsertRowCallback=a},a.prototype.onDeleteRow=function(a){return this.onDeleteRowCallback=a},a.prototype.onValidateFinished=function(a){return this.onValidateFinishedCallback=a},a.prototype.indicatesNextFieldHighlight=function(a){return 40===a.keyCode},a.prototype.indicatesPreviousFieldHighlight=function(a){return 38===a.keyCode},a.prototype.indicatesInsertRow=function(a){return 13===a.keyCode},a.prototype.indicatesDeleteRow=function(a){var b;return b=this.inputField.textrange(),8===a.keyCode&&0===b.start&&0===b.length},a.prototype.setValue=function(a){return this.inputField.val(a),this.validate()},a.prototype.hasCommand=function(){var a;return(null!=(a=this.command)?a.constructor:void 0)===d},a}(),g=function(){function a(b){var c,d,e,f,g,h,i;null==b&&(b={}),null==b.commands&&(b.commands={}),this.elem=$(a.template),this.errorList=$(".rsc-error-list",this.elem),this.numColumns=b.numColumns||u.defaultNumColumns,this.numRows=b.numRows||u.defaultNumRows,this.columns=[],e=$(".rsc-commands-container",this.elem),this.columns=function(){var j,k,l;for(l=[],c=j=0,k=this.numColumns;0<=k?j<k:j>k;c=0<=k?++j:--j)d=$(a.columnTemplate),i=function(){var a,e,i;for(i=[],h=a=0,e=this.numRows;0<=e?a<e:a>e;h=0<=e?++a:--a)g=this.createListItemAt(c,h),g.lineNumber.text(this.getLineNumber(c,h).toString()),f=b.commands[this.getFieldIndex(c,h)],null!=f&&g.setValue(f),d.append(g.elem),i.push(g);return i}.call(this),e.append(d),l.push(i);return l}.call(this)}return a.template="<div class='rsc-command-list'>\n  <h4 class='rsc-computer-font'>Command List</h4>\n  <div class='rsc-commands-container'></div>\n  <div class='rsc-error-list'></div>\n</div>",a.columnTemplate="<div class='rsc-command-list-column'></div>",a.errorMessageTemplate="<p>\n  <u><strong>Line %{lineNumber}</strong></u>:\n  <span class='rsc-computer-font'>%{errorMessage}</span>\n</p>",a.prototype.toBase64=function(){var a;return a={},this.eachField(function(b){return function(c,d,e){var f;if(e.hasCommand())return f=b.getFieldIndex(c,d),a[f]=e.command.toString()}}(this)),btoa(JSON.stringify(a))},a.prototype.createListItemAt=function(a,b){var c;return c=new f,c.onHighlightNextField(function(c){return function(){return c.getField(c.nextColumn(a,b),c.nextRow(a,b)).focus()}}(this)),c.onHighlightPreviousField(function(c){return function(){return c.getField(c.prevColumn(a,b),c.prevRow(a,b)).focus()}}(this)),c.onInsertRow(function(c){return function(){return c.insertRowAt(a,b)}}(this)),c.onDeleteRow(function(c){return function(){return c.deleteRowAt(a,b)}}(this)),c.onValidateFinished(function(a){return function(){return a.updateErrorList(),k.fireIfDefined(a,"onItemValidationFinishedCallback",c)}}(this)),c},a.prototype.insertRowAt=function(a,b){var c,d,e,f,g,h,i,j,k;if(this.canInsert()){for(k=this.getFieldIndex(a,b),d=this.getFieldCount()-1,e=g=i=d,j=k;i<=j?g<j:g>j;e=i<=j?++g:--g)c=this.getFieldAtIndex(e),h=this.getFieldAtIndex(e-1),c.setValue(h.inputField.val());if(k<this.getFieldCount()-1)return f=this.getFieldAtIndex(k+1),f.command=void 0,f.setValue(""),f.focus()}},a.prototype.deleteRowAt=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;if((m=this.getFieldIndex(a,b)-1)>=0){for(h=!1,""===this.getFieldAtIndex(m+1).inputField.val()&&(h=!0,m+=1),d=this.getFieldCount()-1,f=g=j=m,k=d;j<=k?g<k:g>k;f=j<=k?++g:--g)c=this.getFieldAtIndex(f),i=this.getFieldAtIndex(f+1),c.setValue(i.inputField.val());return e=h?m-1:m,l=this.getFieldAtIndex(e),l.focus()}},a.prototype.canInsert=function(){return!this.getField(this.numColumns-1,this.numRows-1).hasCommand()},a.prototype.onItemValidationFinished=function(a){return this.onItemValidationFinishedCallback=a},a.prototype.getErrors=function(){var a;return a=[],this.eachField(function(b){return function(b,c,d){if(d.hasCommand())return a+=d.command.errors}}()),a},a.prototype.updateErrorList=function(){return this.errorList.html(""),this.eachField(function(b){return function(c,d,e){var f,g,h,i,j,k;if(e.hasCommand()){for(j=e.command.errors,k=[],g=0,h=j.length;g<h;g++)f=j[g],i=b.getLineNumber(c,d),k.push(b.errorList.append(a.errorMessageTemplate.replace("%{lineNumber}",i).replace("%{errorMessage}",f)));return k}}}(this))},a.prototype.indicateExecutionForLine=function(a){return this.eachField(function(b){return function(c,d,e){return b.getFieldIndex(c,d)===a?e.showExecutionIndicator():e.hideIndicator()}}(this))},a.prototype.hideExecutionIndicator=function(){return this.eachField(function(a){return function(a,b,c){return c.hideIndicator()}}())},a.prototype.prevColumn=function(a,b){return 0===b&&a>0?a-1:a},a.prototype.prevRow=function(a,b){return 0!==b?b-1:a>0?this.numRows-1:b},a.prototype.nextColumn=function(a,b){return b>=this.numRows-1&&a<this.numColumns-1?a+1:a},a.prototype.nextRow=function(a,b){return b>=this.numRows-1?a<this.numColumns-1?0:b:b+1},a.prototype.getLineNumber=function(a,b){return this.getFieldIndex(a,b)+1},a.prototype.getFieldIndex=function(a,b){return a*this.numRows+b},a.prototype.eachField=function(a){var b,c,d,e,f,g,h,i;for(f=this.columns,g=[],b=d=0,e=f.length;d<e;b=++d)c=f[b],g.push(function(){var d,e,f;for(f=[],h=d=0,e=c.length;d<e;h=++d)i=c[h],f.push(a(b,h,this.getField(b,h)));return f}.call(this));return g},a.prototype.getCommands=function(){var a;return a=[],this.eachField(function(b,c,d){return a.push(d.command)}),a},a.prototype.getField=function(a,b){return this.columns[a][b]},a.prototype.getFieldAtIndex=function(a){return this.getField(this.getColAtIndex(a),this.getRowAtIndex(a))},a.prototype.getColAtIndex=function(a){return Math.floor(a/this.numRows)},a.prototype.getRowAtIndex=function(a){return a%this.numRows},a.prototype.getFieldCount=function(){return this.numRows*this.numColumns},a.prototype.setFieldValueAtIndex=function(a,b){return this.getFieldAtIndex(a).inputField.val(b.toFixed(1))},a.prototype.clearFieldValueAtIndex=function(a){return this.getFieldAtIndex(a).inputField.val("")},a.prototype.reset=function(){return this.hideExecutionIndicator(),this.enable()},a.prototype.clear=function(){return this.eachField(function(a,b,c){return c.clear()}),this.updateErrorList()},a.prototype.disable=function(){return this.eachField(function(a,b,c){return c.disable()})},a.prototype.enable=function(){return this.eachField(function(a,b,c){return c.enable()})},a}(),i=function(){function a(b){null==b&&(b={}),this.elem=$(a.template),this.commandListContainer=$(".rsc-command-list-container",this.elem),this.peripheralsContainer=$(".rsc-peripherals-container",this.elem),this.controlsContainer=$(".rsc-controls-container",this.elem),this.commandList=new g(b),this.commandListContainer.append(this.commandList.elem),this.peripherals=new t,this.peripheralsContainer.append(this.peripherals.elem),this.controls=new j,this.controlsContainer.append(this.controls.elem)}return a.template="<div class='rsc-container'>\n  <div class='rsc-command-list-container'></div>\n  <div class='rsc-peripherals-container'></div>\n  <div class='rsc-controls-container'></div>\n</div>",a.prototype.reset=function(){return this.commandList.reset(),this.controls.reset(),this.peripherals.reset()},a}(),j=function(){function a(){this.elem=$(a.template),this.runProgramButton=new c("Run Program",{classes:["rsc-control-run"]}),this.stepButton=new c("Step",{classes:["rsc-control-step"],enabled:!1}),this.stopButton=new c("Stop",{classes:["rsc-control-step"],enabled:!1}),this.clearMemButton=new c("Clear Mem",{classes:["rsc-control-clear-mem"]}),this.elem.append(this.runProgramButton.elem),this.elem.append(this.stepButton.elem),this.elem.append(this.stopButton.elem),this.elem.append(this.clearMemButton.elem),this.runProgramButton.onClick(function(a){return function(){return k.fireIfDefined(a,"onRunProgramButtonClickedCallback")}}(this)),this.stepButton.onClick(function(a){return function(){return k.fireIfDefined(a,"onStepButtonClickedCallback")}}(this)),this.stopButton.onClick(function(a){return function(){return k.fireIfDefined(a,"onStopButtonClickedCallback")}}(this)),this.clearMemButton.onClick(function(a){return function(){return k.fireIfDefined(a,"onClearMemButtonClickedCallback")}}(this))}return a.template="<div class='rsc-controls'>\n  <h4 class='rsc-computer-font'>Controls</h4>\n</div>",a.prototype.onRunProgramButtonClicked=function(a){return this.onRunProgramButtonClickedCallback=a},a.prototype.onStepButtonClicked=function(a){return this.onStepButtonClickedCallback=a},a.prototype.onStopButtonClicked=function(a){return this.onStopButtonClickedCallback=a},a.prototype.onClearMemButtonClicked=function(a){return this.onClearMemButtonClickedCallback=a},a.prototype.reset=function(){return this.runProgramButton.enable(),this.clearMemButton.enable(),this.stepButton.disable(),this.stopButton.disable()},a}(),o=function(){function a(){this.elem=$(a.template),this.inputField=$("input[type='text']",this.elem),this.errorMessage=$(".rsc-error",this.elem),this.inputField.keydown(function(a){return function(b){if(13===b.keyCode)return E.isNumeric(a.inputField.val())?(k.fireIfDefined(a,"onInputReceivedCallback",parseFloat(a.inputField.val())),a.reset(),a.errorMessage.hide()):a.errorMessage.show()}}(this))}return a.template="<div class='rsc-peripheral-keyboard'>\n  <div class='rsc-keyboard-image'></div>\n  <input type='text' class='rsc-input-field rsc-computer-font' />\n  <div class='rsc-computer-font rsc-error' style='display: none'>\n    Ã— Input must be a number!\n  </div>\n</div>",a.prototype.onInputReceived=function(a){return this.onInputReceivedCallback=a},a.prototype.enable=function(){return this.inputField.prop("disabled",!1)},a.prototype.disable=function(){return this.inputField.prop("disabled",!0)},a.prototype.focus=function(){return this.inputField.focus()},a.prototype.reset=function(){return this.errorMessage.hide(),this.hideIndicator(),this.inputField.val("")},a.prototype.showIndicator=function(a){var b,c;return null==a&&(a=!0),a?(b=0,c=setInterval(function(a){return function(){if(a.elem.hasClass("info")?a.elem.removeClass("info"):a.elem.addClass("info"),5===(b+=1))return clearInterval(c),a.elem.addClass("info")}}(this),100)):this.elem.addClass("info")},a.prototype.hideIndicator=function(){return this.elem.removeClass("info")},a}(),q=function(){function a(){this.elem=$(a.template),this.outputField=$(".rsc-monitor-output-field",this.elem)}return a.template="<div class='rsc-peripheral-monitor'>\n  <div class='rsc-monitor-image'>\n    <div class='rsc-monitor-output-field rsc-computer-font'></div>\n  </div>\n</div>",a.prototype.displayValue=function(a){if(E.isNumeric(a))return this.outputField.text(a.toFixed(1))},a.prototype.reset=function(){return this.outputField.text("")},a}(),t=function(){function b(){this.elem=$(b.template),this.accumulator=new a,this.elem.append(this.accumulator.elem),this.monitor=new q,this.elem.append(this.monitor.elem),this.keyboard=new o,this.elem.append(this.keyboard.elem)}return b.template="<div class='rsc-peripherals'>\n  <h4 class='rsc-computer-font'>Peripherals</h4>\n</div>",b.prototype.reset=function(){return this.monitor.reset(),this.keyboard.reset()},b}()}).call(this);